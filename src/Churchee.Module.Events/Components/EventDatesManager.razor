@using Churchee.Module.Events.Models
@using Churchee.Module.UI.Models
@using Microsoft.AspNetCore.Components.Routing
@using Radzen
@using Radzen.Blazor

@foreach(var item in Dates.OrderBy(o => o.Start))
{
    <RadzenStack Orientation="Orientation.Horizontal">

        <div>
            @if(item.Start != null)
            {
                <div>@item.Start.Value.ToString("dd/MM/yyyy HH:mm")</div>
            }
        </div>
        <div>

            @if (item.End != null)
            {
                <div>@item.End.Value.ToString("dd/MM/yyyy HH:mm")</div>
            }
        </div>

        <RadzenButton Icon="delete" class="btn-remove" ButtonStyle="ButtonStyle.Danger" Click="() => RemoveEntry(item)"></RadzenButton>


    </RadzenStack>
}


    <RadzenStack Orientation="Orientation.Horizontal">

    <RadzenDatePicker Max=@End?.Date DateFormat="dd-MM-yyyy HH:mm" ShowTime=true @bind-Value=Start />
    <RadzenDatePicker Min=@Start?.Date DateFormat="dd-MM-yyyy HH:mm" ShowTime=true @bind-Value=End />

    <RadzenButton ButtonStyle="ButtonStyle.Success" class="btn-add" Icon="add" Click="AddEntry"></RadzenButton>

</RadzenStack>



@code {

    [Parameter] 
    public List<EventDateModel> Dates { get; set; }

    public DateTime? Start { get; set; }
    public DateTime? End { get; set; }

    [Inject]
    protected NotificationService NotificationService { get; set; } = default!;

    public void AddEntry()
    {
        if (Start == null)
        {
            NotificationService.Notify(NotificationSeverity.Warning, "Validation", "Start date is required.");

            return;
        }
        if (End != null && End < Start )
        {
            NotificationService.Notify(NotificationSeverity.Warning, "Validation", "End date must be after start date.");

            return;
        }

        Dates.Add(new EventDateModel(Start, End));

        Start = null;
        End = null;

        StateHasChanged();
    }

    public void RemoveEntry(EventDateModel item)
    {
        Dates.Remove(item);

        StateHasChanged();
    }

}
