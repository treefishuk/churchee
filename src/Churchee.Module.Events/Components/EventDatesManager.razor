@using Churchee.Module.Events.Models
@using Churchee.Module.UI.Models
@using Microsoft.AspNetCore.Components.Routing
@using Radzen
@using Radzen.Blazor


<RadzenStack Orientation="Orientation.Horizontal">

    <RadzenFormField Text="Start" AllowFloatingLabel="false">

        <RadzenDatePicker Max=@End?.Date DateFormat="dd-MM-yyyy HH:mm" ShowTime=true @bind-Value=Start />

    </RadzenFormField>

    <RadzenFormField Text="End" AllowFloatingLabel="false">

        <RadzenDatePicker Min=@Start?.Date DateFormat="dd-MM-yyyy HH:mm" ShowTime=true @bind-Value=End />

    </RadzenFormField>


    <RadzenButton ButtonStyle="ButtonStyle.Success" class="btn-add rz-mt-2" Icon="add" Click="AddEntry"></RadzenButton>

</RadzenStack>


<RadzenDataGrid @ref="radzenGrid" Data="@Dates" IsLoading="false" AllowSorting="true" AllowFiltering="true" AllowPaging="true" AllowColumnResize="true" AllowColumnPicking="false" PageSize="15" PagerHorizontalAlign="HorizontalAlign.Center" TItem="EventDateModel">
    <Columns>
        <RadzenDataGridColumn TItem="EventDateModel" Property="Start" Title="Start" Visible="true" FormatString="{0:dd/MM/yyyy}" SortOrder="SortOrder.Ascending" />
        <RadzenDataGridColumn TItem="EventDateModel" Property="End" Title="End" Visible="true" FormatString="{0:dd/MM/yyyy}" />
        <RadzenDataGridColumn TItem="EventDateModel" Title="" Sortable="false" Filterable="false" Width="100px" TextAlign="TextAlign.Center" Pickable="false">
            <Template Context="data">
                <RadzenButton Icon="delete" class="delete-row" ButtonStyle="ButtonStyle.Danger" Click="() => RemoveEntry(data)"></RadzenButton>
            </Template>
        </RadzenDataGridColumn>
    </Columns>
</RadzenDataGrid>

@code {

    [Parameter] 
    public List<EventDateModel> Dates { get; set; }

    public DateTime? Start { get; set; }
    public DateTime? End { get; set; }

    RadzenDataGrid<EventDateModel> radzenGrid = default!;

    [Inject]
    protected NotificationService NotificationService { get; set; } = default!;

    private async Task AddEntry()
    {
        if (Start == null)
        {
            NotificationService.Notify(NotificationSeverity.Warning, "Validation", "Start date is required.");

            return;
        }
        if (End != null && End < Start )
        {
            NotificationService.Notify(NotificationSeverity.Warning, "Validation", "End date must be after start date.");

            return;
        }

        Dates.Add(new EventDateModel(Start, End));

        Start = null;
        End = null;

        await radzenGrid.Reload();
    }

    private async Task RemoveEntry(EventDateModel item)
    {
        Dates.Remove(item);

        await radzenGrid.Reload();
    }

}
