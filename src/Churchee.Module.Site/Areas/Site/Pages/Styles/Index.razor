@page "/management/styles"
@inherits BasePage
@using BlazorMonaco
@using BlazorMonaco.Editor
@using BlazorMonaco.Languages
@using Churchee.Module.Site.Areas.Site.Models
@using Churchee.Module.Site.Features.Styles.Commands
@using Churchee.Module.Site.Features.Styles.Queries
@using Microsoft.AspNetCore.Components.Web
@using Microsoft.Extensions.Logging
@using Radzen.Blazor
@using Radzen
@using Churchee.Module.UI.Components

<PageName></PageName>

<FullPageOverlay Visible="overlayVisible"/>

<Form InputModel="@InputModel" OnSave=@(async () => await ValidSubmitForm()) />


    @code {

    public StylesInputModel InputModel { get; set; } = new();

    private bool overlayVisible = false;

    protected override async Task OnInitializedAsync()
    {
        string result = await Mediator.Send(new GetStylesQuery());

        InputModel = new StylesInputModel(result);
    }

    private async Task ValidSubmitForm()
    {
        overlayVisible = true;

        var result = await Mediator.Send(new UpdateStylesCommand(InputModel.Styles));

        overlayVisible = false;

        NotificationService.Notify(result);
    }
}
