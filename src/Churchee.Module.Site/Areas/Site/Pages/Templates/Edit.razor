@page "/management/templates/edit/{Id:guid}"
@inherits BasePage
@using Churchee.Module.Site.Areas.Site.Models
@using Churchee.Module.Site.Features.Templates.Commands.UpdateTemplateContent
@using Churchee.Module.Site.Features.Templates.Queries.GetTemplateById
@using Churchee.Module.UI.Components
@using Microsoft.AspNetCore.Components.Web
@using Microsoft.Extensions.Logging
@using Radzen

<PageName Name="Edit Template"></PageName>

<PageTitle>@InputModel.Content.Split('/').Last().Replace(".cshtml", "")</PageTitle>

<Form InputModel="@InputModel" OnSave=@(async () => await ValidSubmitForm()) />

@code {
    [SupplyParameterFromForm]
    public EditTemplateInputModel InputModel { get; set; } = new();

    [Parameter]
    public Guid Id { get; set; }

    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();

        var response = await Mediator.Send(new GetTemplateByIdQuery(Id));

        InputModel = new EditTemplateInputModel(response.Id, response.Content);

    }

    private async Task ValidSubmitForm()
    {
        var result = await Mediator.Send(new UpdateTemplateContentComand(InputModel.Id, InputModel.Content));
       
        NotificationService.Notify(new NotificationMessage { Severity = NotificationSeverity.Success, Summary = "Saved Successfully" });
    }
}
